<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Impact Dashboard</title>
</head>
<body class="font-sans bg-gray-50 text-gray-800 leading-relaxed">

  <!-- Navigation -->
  <nav class="mb-6 text-center space-x-4">
    <a href="opencall.html" class="text-indigo-600 hover:underline">OpenCall</a>
    <a href="impactlog.html" class="text-green-600 hover:underline">ImpactLog</a>
    <a href="dashboard.html" class="text-purple-600 hover:underline font-semibold">Dashboard</a>
    <a href="impactcard.html" class="text-blue-600 hover:underline">Impact Card</a>
  </nav>

  <section class="max-w-5xl mx-auto p-6">
    <header class="mb-6 text-center">
      <div class="flex justify-center space-x-4 mb-4">
        <a href="index.html" class="text-blue-500 hover:underline">← Back to Home</a>
        <a href="dashboard_enhanced.html" class="text-purple-500 hover:underline">📊 Enhanced Dashboard</a>
      </div>
      <h2 class="text-3xl font-bold text-purple-700">📊 Impact Dashboard</h2>
      <p class="text-lg text-gray-700">Visualize your journey. Celebrate your growth.</p>
    </header>

    <!-- Affirmation Banner -->
    <div class="bg-purple-100 border-l-4 border-purple-500 text-purple-700 p-4 mb-6 rounded">
      🌱 Every reflection is a step toward deeper impact.
    </div>

    <!-- Idea Metrics -->
    <section class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold text-green-700 mb-2">🌱 Total Ideas Submitted</h3>
        <p id="totalIdeas" class="text-3xl font-bold text-gray-800">0</p>
      </div>
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold text-purple-700 mb-2">🌼 Ideas Saved for Later</h3>
        <p id="savedIdeasCount" class="text-3xl font-bold text-gray-800">0</p>
      </div>
    </section>

    <!-- Emotional Tone Breakdown -->
    <section class="mb-10">
      <h3 class="text-xl font-semibold text-blue-700 mb-4">🎨 Emotional Tone Breakdown</h3>
      <ul id="toneBreakdown" class="space-y-2 text-gray-700 text-sm"></ul>
    </section>

    <!-- Common Tags -->
    <section class="mb-10">
      <h3 class="text-xl font-semibold text-yellow-700 mb-4">🏷️ Most Common Tags</h3>
      <div id="commonTags" class="flex flex-wrap gap-2"></div>
    </section>

    <!-- Reflections by Cause -->
    <section class="mb-10">
      <h3 class="text-xl font-semibold text-purple-700 mb-4">🎯 Reflections by Cause</h3>
      <ul id="causeStats" class="space-y-2"></ul>
    </section>

    <!-- Recent Reflections -->
    <section class="mb-10">
      <h3 class="text-xl font-semibold text-purple-700 mb-4">📝 Recent Reflections</h3>
      <div id="recentLogs" class="space-y-4"></div>
    </section>

    <!-- Timeline Stats -->
    <section>
      <h3 class="text-xl font-semibold text-purple-700 mb-4">📅 Reflection Timeline</h3>
      <ul id="timelineStats" class="space-y-2"></ul>
    </section>
  </section>

  <script>
    const logs = JSON.parse(localStorage.getItem('impactLogs')) || [];
    const ideas = JSON.parse(localStorage.getItem('impactIdeas')) || [];
    const savedIdeas = JSON.parse(localStorage.getItem('savedIdeas')) || [];

    // Total counts
    document.getElementById('totalIdeas').textContent = ideas.length;
    document.getElementById('savedIdeasCount').textContent = savedIdeas.length;

    // Emotional tone breakdown
    const toneCounts = { hopeful: 0, urgent: 0, curious: 0 };
    ideas.forEach(idea => {
      if (toneCounts[idea.tone] !== undefined) toneCounts[idea.tone]++;
    });

    const toneBreakdown = document.getElementById('toneBreakdown');
    Object.entries(toneCounts).forEach(([tone, count]) => {
      const li = document.createElement('li');
      li.textContent = `${tone.charAt(0).toUpperCase() + tone.slice(1)}: ${count}`;
      toneBreakdown.appendChild(li);
    });

    // Common tags
    const tagMap = {};
    ideas.forEach(idea => {
      if (idea.tags) {
        idea.tags.split(',').forEach(tag => {
          const cleanTag = tag.trim().toLowerCase();
          tagMap[cleanTag] = (tagMap[cleanTag] || 0) + 1;
        });
      }
    });

    const sortedTags = Object.entries(tagMap).sort((a, b) => b[1] - a[1]);
    const commonTags = document.getElementById('commonTags');
    sortedTags.slice(0, 10).forEach(([tag, count]) => {
      const span = document.createElement('span');
      span.className = 'bg-yellow-100 text-yellow-700 text-xs px-2 py-1 rounded-full';
      span.textContent = `${tag} (${count})`;
      commonTags.appendChild(span);
    });

    // Reflections by Cause
    const causeStats = document.getElementById('causeStats');
    const causeCount = {};
    logs.forEach(log => {
      const cause = log.values?.replace('Cause: ', '') || 'Unspecified';
      causeCount[cause] = (causeCount[cause] || 0) + 1;
    });
    for (const cause in causeCount) {
      const item = document.createElement('li');
      item.textContent = `${cause}: ${causeCount[cause]} reflections`;
      item.className = 'text-sm text-gray-700';
      causeStats.appendChild(item);
    }

    // Recent Reflections
    const recentLogs = document.getElementById('recentLogs');
    logs.slice(0, 3).forEach(log => {
      const card = document.createElement('div');
      card.className = 'bg-white rounded-lg shadow-md p-4';
      card.innerHTML = `
        <p class="text-xs text-gray-500 mb-2">Date: ${log.date}</p>
        <h4 class="font-bold text-purple-700 mb-1">🌱 ${log.action}</h4>
        <p class="text-sm text-gray-700"><strong>Learned:</strong> ${log.learning}</p>
        ${log.values ? `<p class="text-sm text-gray-700 mt-1"><strong>Cause:</strong> ${log.values.replace('Cause: ', '')}</p>` : ''}
      `;
      recentLogs.appendChild(card);
    });

    // Timeline Stats
    const timelineStats = document.getElementById('timelineStats');
    const dateCount = {};
    logs.forEach(log => {
      dateCount[log.date] = (dateCount[log.date] || 0) + 1;
    });
    for (const date in dateCount) {
      const item = document.createElement('li');
      item.textContent = `${date}: ${dateCount[date]} reflection(s)`;
      item.className = 'text-sm text-gray-700';
      timelineStats.appendChild(item);
    }
  </script>
</body>
</html>
