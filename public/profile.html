<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile & Settings - IMPACT</title>
  <link href="output.css" rel="stylesheet">
  <link href="animations.css" rel="stylesheet">
  
  <!-- Firebase Integration -->
  <script type="module" src="firebase-config.js"></script>
  <script src="impact-data-layer.js"></script>
  
  <!-- Authentication -->
  <script src="auth-manager.js"></script>
  
  <!-- PWA Features -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#10b981">
  
  <style>
    .profile-card {
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      border-left: 4px solid #3b82f6;
    }
    
    .stats-card {
      background: linear-gradient(135deg, #ecfdf5, #d1fae5);
      border-left: 4px solid #10b981;
    }
    
    .achievements-card {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border-left: 4px solid #f59e0b;
    }
    
    .settings-card {
      background: linear-gradient(135deg, #f3e8ff, #e9d5ff);
      border-left: 4px solid #8b5cf6;
    }
    
    .avatar-upload {
      position: relative;
      display: inline-block;
    }
    
    .avatar-upload:hover .avatar-overlay {
      opacity: 1;
    }
    
    .avatar-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      cursor: pointer;
    }
    
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      color: white;
      border-radius: 2rem;
      font-weight: 600;
      font-size: 0.875rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .skill-tag {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 500;
    }
    
    .interest-tag {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 500;
    }
    
    .auth-provider-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      width: 100%;
      padding: 0.75rem 1.5rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.75rem;
      background: white;
      color: #374151;
      font-weight: 600;
      transition: all 0.2s ease;
      text-decoration: none;
    }
    
    .auth-provider-btn:hover {
      border-color: #10b981;
      background: #f0fdf4;
      transform: translateY(-1px);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .google-btn {
      border-color: #ea4335;
    }
    
    .google-btn:hover {
      border-color: #ea4335;
      background: #fef2f2;
    }
    
    .github-btn {
      border-color: #24292e;
    }
    
    .github-btn:hover {
      border-color: #24292e;
      background: #f9fafb;
    }
    
    .upgrade-banner {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      color: white;
      padding: 1rem;
      border-radius: 1rem;
      margin-bottom: 2rem;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- Navigation -->
  <nav class="bg-white shadow-md p-4 sticky top-0 z-40">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-4">
        <a href="index.html" class="text-2xl">🌱</a>
        <h1 class="text-xl font-bold text-gray-800">Profile & Settings</h1>
      </div>
      <div class="flex items-center space-x-4">
        <span id="authStatus" class="text-sm text-gray-600">Loading...</span>
        <button id="signOutBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-semibold" style="display: none;">
          Sign Out
        </button>
      </div>
    </div>
  </nav>

  <!-- Guest User Upgrade Banner -->
  <div id="upgradeBanner" class="upgrade-banner mx-4 mt-4" style="display: none;">
    <div class="flex items-center justify-between">
      <div>
        <h3 class="font-bold text-lg mb-1">🚀 Unlock Your Full IMPACT Experience!</h3>
        <p class="text-sm opacity-90">Sign in to save your progress, sync across devices, and access premium features.</p>
      </div>
      <button onclick="showLoginModal()" class="bg-white text-orange-600 px-6 py-2 rounded-lg font-semibold hover:bg-gray-100">
        Sign In
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-6xl mx-auto p-4">
    
    <!-- Profile Overview -->
    <div class="profile-card rounded-xl shadow-lg p-6 mb-6">
      <div class="flex flex-col md:flex-row items-start md:items-center gap-6">
        <!-- Avatar Section -->
        <div class="avatar-upload">
          <div class="w-24 h-24 bg-gray-200 rounded-full overflow-hidden">
            <img id="userAvatar" src="" alt="Profile" class="w-full h-full object-cover" style="display: none;">
            <div id="avatarPlaceholder" class="w-full h-full flex items-center justify-center text-3xl font-bold text-gray-500">
              ?
            </div>
          </div>
          <div class="avatar-overlay">
            <span class="text-white text-sm font-semibold">📷</span>
          </div>
          <input type="file" id="avatarUpload" accept="image/*" class="hidden">
        </div>
        
        <!-- User Info -->
        <div class="flex-1">
          <h2 id="userName" class="text-2xl font-bold text-gray-800 mb-2">Loading...</h2>
          <p id="userEmail" class="text-gray-600 mb-2"></p>
          <p id="userBio" class="text-gray-700 mb-4"></p>
          
          <!-- Quick Stats -->
          <div class="flex flex-wrap gap-4 text-sm">
            <div class="flex items-center gap-2">
              <span>⏰</span>
              <span id="volunteerHours">0 hours volunteered</span>
            </div>
            <div class="flex items-center gap-2">
              <span>🎯</span>
              <span id="projectsCompleted">0 projects completed</span>
            </div>
            <div class="flex items-center gap-2">
              <span>👥</span>
              <span id="teamsJoined">0 teams joined</span>
            </div>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="flex flex-col gap-2">
          <button onclick="showEditProfileModal()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold">
            Edit Profile
          </button>
          <button onclick="showAchievements()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-lg font-semibold">
            🏆 Achievements
          </button>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="flex flex-wrap gap-2 mb-6">
      <button class="tab-btn active px-6 py-3 rounded-lg font-semibold bg-green-500 text-white" data-tab="volunteer">
        🎯 Volunteer Profile
      </button>
      <button class="tab-btn px-6 py-3 rounded-lg font-semibold bg-gray-200 text-gray-700" data-tab="stats">
        📊 Stats & Progress
      </button>
      <button class="tab-btn px-6 py-3 rounded-lg font-semibold bg-gray-200 text-gray-700" data-tab="achievements">
        🏆 Achievements
      </button>
      <button class="tab-btn px-6 py-3 rounded-lg font-semibold bg-gray-200 text-gray-700" data-tab="settings">
        ⚙️ Settings
      </button>
    </div>

    <!-- Tab Content -->
    
    <!-- Volunteer Profile Tab -->
    <div id="volunteerTab" class="tab-content">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        
        <!-- Skills -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">💪 Skills</h3>
          <div id="skillsDisplay" class="flex flex-wrap gap-2 mb-4">
            <!-- Skills will be displayed here -->
          </div>
          <button onclick="editSkills()" class="text-green-600 hover:text-green-700 font-semibold">+ Add Skills</button>
        </div>

        <!-- Interests -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">❤️ Interests</h3>
          <div id="interestsDisplay" class="flex flex-wrap gap-2 mb-4">
            <!-- Interests will be displayed here -->
          </div>
          <button onclick="editInterests()" class="text-blue-600 hover:text-blue-700 font-semibold">+ Add Interests</button>
        </div>

        <!-- Availability -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">⏰ Availability</h3>
          <div id="availabilityDisplay">
            <!-- Availability will be displayed here -->
          </div>
          <button onclick="editAvailability()" class="text-purple-600 hover:text-purple-700 font-semibold mt-4">Edit Availability</button>
        </div>

        <!-- Preferences -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">🎯 Preferences</h3>
          <div id="preferencesDisplay">
            <!-- Preferences will be displayed here -->
          </div>
          <button onclick="editPreferences()" class="text-orange-600 hover:text-orange-700 font-semibold mt-4">Edit Preferences</button>
        </div>
      </div>
    </div>

    <!-- Stats Tab -->
    <div id="statsTab" class="tab-content" style="display: none;">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        
        <!-- Impact Stats -->
        <div class="stats-card rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-semibold text-green-800 mb-4">🌱 Impact Stats</h3>
          <div class="space-y-3">
            <div class="flex justify-between">
              <span>Volunteer Hours:</span>
              <span id="statsVolunteerHours" class="font-bold text-green-600">0</span>
            </div>
            <div class="flex justify-between">
              <span>Projects Completed:</span>
              <span id="statsProjectsCompleted" class="font-bold text-green-600">0</span>
            </div>
            <div class="flex justify-between">
              <span>Teams Joined:</span>
              <span id="statsTeamsJoined" class="font-bold text-green-600">0</span>
            </div>
            <div class="flex justify-between">
              <span>Impact Points:</span>
              <span id="statsImpactPoints" class="font-bold text-green-600">0</span>
            </div>
          </div>
        </div>

        <!-- Engagement Stats -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">📈 Engagement</h3>
          <div class="space-y-3">
            <div class="flex justify-between">
              <span>Current Streak:</span>
              <span id="statsStreak" class="font-bold text-blue-600">0 days</span>
            </div>
            <div class="flex justify-between">
              <span>Ideas Submitted:</span>
              <span id="statsIdeas" class="font-bold text-blue-600">0</span>
            </div>
            <div class="flex justify-between">
              <span>Opportunities Applied:</span>
              <span id="statsApplications" class="font-bold text-blue-600">0</span>
            </div>
            <div class="flex justify-between">
              <span>Last Active:</span>
              <span id="statsLastActive" class="font-bold text-blue-600">Today</span>
            </div>
          </div>
        </div>

        <!-- Progress Chart Placeholder -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">📊 Progress Overview</h3>
          <div class="text-center py-8 text-gray-500">
            <div class="text-4xl mb-2">📈</div>
            <p>Progress charts coming soon!</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Achievements Tab -->
    <div id="achievementsTab" class="tab-content" style="display: none;">
      <div class="achievements-card rounded-xl shadow-lg p-6 mb-6">
        <h3 class="text-lg font-semibold text-yellow-800 mb-4">🏆 Your Achievements</h3>
        <div id="achievementsDisplay" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <!-- Achievements will be displayed here -->
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">🎖️ Badges</h3>
        <div id="badgesDisplay" class="flex flex-wrap gap-3">
          <!-- Badges will be displayed here -->
        </div>
      </div>
    </div>

    <!-- Settings Tab -->
    <div id="settingsTab" class="tab-content" style="display: none;">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        
        <!-- Notification Preferences -->
        <div class="settings-card rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-semibold text-purple-800 mb-4">🔔 Notifications</h3>
          <div class="space-y-4">
            <label class="flex items-center space-x-3">
              <input type="checkbox" id="emailNotifications" class="rounded">
              <span>Email notifications</span>
            </label>
            <label class="flex items-center space-x-3">
              <input type="checkbox" id="pushNotifications" class="rounded">
              <span>Push notifications</span>
            </label>
            <label class="flex items-center space-x-3">
              <input type="checkbox" id="opportunityAlerts" class="rounded">
              <span>New opportunity alerts</span>
            </label>
            <label class="flex items-center space-x-3">
              <input type="checkbox" id="teamUpdates" class="rounded">
              <span>Team updates</span>
            </label>
            <label class="flex items-center space-x-3">
              <input type="checkbox" id="achievementAlerts" class="rounded">
              <span>Achievement notifications</span>
            </label>
          </div>
        </div>

        <!-- Privacy Settings -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">🔒 Privacy</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Profile Visibility</label>
              <select id="profileVisibility" class="w-full border border-gray-300 rounded-lg p-3">
                <option value="public">Public - Visible to everyone</option>
                <option value="members">Members only</option>
                <option value="private">Private - Only me</option>
              </select>
            </div>
            <label class="flex items-center space-x-3">
              <input type="checkbox" id="showEmail" class="rounded">
              <span>Show email address on profile</span>
            </label>
            <label class="flex items-center space-x-3">
              <input type="checkbox" id="showLocation" class="rounded">
              <span>Show location on profile</span>
            </label>
            <label class="flex items-center space-x-3">
              <input type="checkbox" id="showStats" class="rounded">
              <span>Show stats and achievements</span>
            </label>
          </div>
        </div>

        <!-- AI Settings -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">🤖 AI Features</h3>
          <div class="space-y-4">
            <label class="flex items-center space-x-3">
              <input type="checkbox" id="enableAIMatching" class="rounded">
              <span>Enable AI-powered matching</span>
            </label>
            <label class="flex items-center space-x-3">
              <input type="checkbox" id="diversityRecommendations" class="rounded">
              <span>Show diversity recommendations</span>
            </label>
            <label class="flex items-center space-x-3">
              <input type="checkbox" id="learningFromInteractions" class="rounded">
              <span>Let AI learn from my interactions</span>
            </label>
          </div>
        </div>

        <!-- Account Actions -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">👤 Account</h3>
          <div class="space-y-3">
            <button onclick="exportData()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold">
              📥 Export My Data
            </button>
            <button onclick="resetProgress()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-4 rounded-lg font-semibold">
              🔄 Reset Progress
            </button>
            <button onclick="deleteAccount()" class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg font-semibold">
              🗑️ Delete Account
            </button>
          </div>
        </div>
      </div>
      
      <!-- Save Settings Button -->
      <div class="mt-6 text-center">
        <button onclick="saveSettings()" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-lg font-semibold">
          💾 Save All Settings
        </button>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" style="display: none;">
    <div class="bg-white rounded-2xl p-8 max-w-md w-full">
      <div class="text-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-2">Welcome to IMPACT</h2>
        <p class="text-gray-600">Sign in to unlock your full volunteer potential</p>
      </div>

      <!-- Social Login Buttons -->
      <div class="space-y-3 mb-6">
        <button id="googleSignIn" class="auth-provider-btn google-btn">
          <svg class="w-5 h-5" viewBox="0 0 24 24">
            <path fill="#ea4335" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
            <path fill="#34a853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
            <path fill="#fbbc05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
            <path fill="#ea4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
          </svg>
          Continue with Google
        </button>
        
        <button id="githubSignIn" class="auth-provider-btn github-btn">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
          Continue with GitHub
        </button>
      </div>

      <!-- Email Login Form -->
      <div class="border-t pt-6">
        <div id="loginForm">
          <h3 class="text-lg font-semibold mb-4">Or sign in with email</h3>
          <div class="space-y-4">
            <input type="email" id="loginEmail" placeholder="Email address" class="w-full border border-gray-300 rounded-lg p-3">
            <input type="password" id="loginPassword" placeholder="Password" class="w-full border border-gray-300 rounded-lg p-3">
            <button onclick="signInWithEmail()" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-semibold">
              Sign In
            </button>
          </div>
          <p class="text-center mt-4 text-sm text-gray-600">
            Don't have an account? 
            <button onclick="showSignUpForm()" class="text-green-600 hover:text-green-700 font-semibold">Sign up</button>
          </p>
        </div>

        <div id="signUpForm" style="display: none;">
          <h3 class="text-lg font-semibold mb-4">Create your account</h3>
          <div class="space-y-4">
            <input type="text" id="signUpName" placeholder="Full name" class="w-full border border-gray-300 rounded-lg p-3">
            <input type="email" id="signUpEmail" placeholder="Email address" class="w-full border border-gray-300 rounded-lg p-3">
            <input type="password" id="signUpPassword" placeholder="Password" class="w-full border border-gray-300 rounded-lg p-3">
            <button onclick="signUpWithEmail()" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-semibold">
              Create Account
            </button>
          </div>
          <p class="text-center mt-4 text-sm text-gray-600">
            Already have an account? 
            <button onclick="showLoginForm()" class="text-green-600 hover:text-green-700 font-semibold">Sign in</button>
          </p>
        </div>
      </div>

      <div class="text-center mt-6">
        <button onclick="hideLoginModal()" class="text-gray-500 hover:text-gray-700">Continue as guest</button>
      </div>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div id="editProfileModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" style="display: none;">
    <div class="bg-white rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Edit Profile</h2>
        <button onclick="hideEditProfileModal()" class="text-gray-400 hover:text-gray-600 text-3xl">&times;</button>
      </div>

      <form id="editProfileForm" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Display Name</label>
            <input type="text" id="editDisplayName" class="w-full border border-gray-300 rounded-lg p-3">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
            <input type="text" id="editLocation" class="w-full border border-gray-300 rounded-lg p-3">
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Bio</label>
          <textarea id="editBio" rows="3" class="w-full border border-gray-300 rounded-lg p-3" placeholder="Tell us about yourself..."></textarea>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Experience Level</label>
            <select id="editExperience" class="w-full border border-gray-300 rounded-lg p-3">
              <option value="beginner">Beginner</option>
              <option value="intermediate">Intermediate</option>
              <option value="advanced">Advanced</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Time Commitment</label>
            <select id="editTimeCommitment" class="w-full border border-gray-300 rounded-lg p-3">
              <option value="flexible">Flexible</option>
              <option value="low">Low (1-5 hours/month)</option>
              <option value="medium">Medium (5-15 hours/month)</option>
              <option value="high">High (15+ hours/month)</option>
            </select>
          </div>
        </div>

        <div class="flex justify-end space-x-4">
          <button type="button" onclick="hideEditProfileModal()" class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg font-semibold">
            Cancel
          </button>
          <button type="submit" class="px-8 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold">
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    let currentUser = null;
    let currentProfile = null;

    // Initialize page
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('🔐 Profile page initializing...');
      
      // Wait for auth manager
      const waitForAuth = setInterval(() => {
        if (window.authManager) {
          clearInterval(waitForAuth);
          setupProfilePage();
        }
      }, 500);

      // Setup tab switching
      setupTabs();
      
      // Setup form handlers
      setupFormHandlers();
    });

    // Setup profile page
    async function setupProfilePage() {
      // Listen for auth state changes
      window.authManager.onAuthStateChange((authState) => {
        currentUser = authState.user;
        currentProfile = authState.profile;
        updateProfileDisplay();
      });

      console.log('✅ Profile page ready');
    }

    // Update profile display
    function updateProfileDisplay() {
      if (!currentUser || !currentProfile) return;

      // Update auth status
      const authStatus = document.getElementById('authStatus');
      const signOutBtn = document.getElementById('signOutBtn');
      
      if (currentUser.isGuest) {
        authStatus.textContent = '👤 Guest User';
        document.getElementById('upgradeBanner').style.display = 'block';
        signOutBtn.style.display = 'none';
      } else {
        authStatus.textContent = `🔐 ${currentUser.displayName || currentUser.email}`;
        document.getElementById('upgradeBanner').style.display = 'none';
        signOutBtn.style.display = 'block';
      }

      // Update profile info
      document.getElementById('userName').textContent = currentProfile.personalInfo.displayName;
      document.getElementById('userEmail').textContent = currentProfile.personalInfo.email || '';
      document.getElementById('userBio').textContent = currentProfile.personalInfo.bio || 'No bio added yet.';

      // Update avatar
      const avatar = document.getElementById('userAvatar');
      const placeholder = document.getElementById('avatarPlaceholder');
      
      if (currentProfile.personalInfo.photoURL) {
        avatar.src = currentProfile.personalInfo.photoURL;
        avatar.style.display = 'block';
        placeholder.style.display = 'none';
      } else {
        avatar.style.display = 'none';
        placeholder.style.display = 'flex';
        placeholder.textContent = currentProfile.personalInfo.displayName.charAt(0).toUpperCase();
      }

      // Update stats
      const stats = currentProfile.stats;
      document.getElementById('volunteerHours').textContent = `${stats.totalVolunteerHours} hours volunteered`;
      document.getElementById('projectsCompleted').textContent = `${stats.projectsCompleted} projects completed`;
      document.getElementById('teamsJoined').textContent = `${stats.teamsJoined} teams joined`;

      // Update detailed stats
      document.getElementById('statsVolunteerHours').textContent = stats.totalVolunteerHours;
      document.getElementById('statsProjectsCompleted').textContent = stats.projectsCompleted;
      document.getElementById('statsTeamsJoined').textContent = stats.teamsJoined;
      document.getElementById('statsImpactPoints').textContent = stats.impactPoints;
      document.getElementById('statsStreak').textContent = `${stats.streakDays} days`;

      // Update volunteer profile
      updateSkillsDisplay();
      updateInterestsDisplay();
      updateAvailabilityDisplay();
      updatePreferencesDisplay();
      updateAchievementsDisplay();
      updateSettingsDisplay();

      console.log('✅ Profile display updated');
    }

    // Update skills display
    function updateSkillsDisplay() {
      const container = document.getElementById('skillsDisplay');
      const skills = currentProfile.volunteerProfile.skills || [];
      
      container.innerHTML = skills.map(skill => 
        `<span class="skill-tag">${skill}</span>`
      ).join('');
    }

    // Update interests display
    function updateInterestsDisplay() {
      const container = document.getElementById('interestsDisplay');
      const interests = currentProfile.volunteerProfile.interests || [];
      
      container.innerHTML = interests.map(interest => 
        `<span class="interest-tag">${interest}</span>`
      ).join('');
    }

    // Update availability display
    function updateAvailabilityDisplay() {
      const container = document.getElementById('availabilityDisplay');
      const availability = currentProfile.volunteerProfile.availability || [];
      const timeCommitment = currentProfile.volunteerProfile.timeCommitment;
      const workStyle = currentProfile.volunteerProfile.workStyle;
      
      container.innerHTML = `
        <div class="space-y-2">
          <div><strong>When:</strong> ${availability.join(', ') || 'Not specified'}</div>
          <div><strong>Time Commitment:</strong> ${timeCommitment}</div>
          <div><strong>Work Style:</strong> ${workStyle}</div>
        </div>
      `;
    }

    // Update preferences display
    function updatePreferencesDisplay() {
      const container = document.getElementById('preferencesDisplay');
      const experience = currentProfile.volunteerProfile.experience;
      const impactAreas = currentProfile.volunteerProfile.preferredImpactAreas || [];
      
      container.innerHTML = `
        <div class="space-y-2">
          <div><strong>Experience Level:</strong> ${experience}</div>
          <div><strong>Preferred Impact Areas:</strong> ${impactAreas.join(', ') || 'Open to all'}</div>
        </div>
      `;
    }

    // Update achievements display
    function updateAchievementsDisplay() {
      const achievementsContainer = document.getElementById('achievementsDisplay');
      const badgesContainer = document.getElementById('badgesDisplay');
      
      const achievements = currentProfile.achievements || [];
      const badges = currentProfile.badges || [];
      
      if (achievements.length === 0) {
        achievementsContainer.innerHTML = `
          <div class="col-span-full text-center py-8 text-gray-500">
            <div class="text-4xl mb-2">🏆</div>
            <p>No achievements yet. Start volunteering to unlock achievements!</p>
          </div>
        `;
      } else {
        achievementsContainer.innerHTML = achievements.map(achievement => `
          <div class="bg-white p-4 rounded-lg border-l-4 border-yellow-400">
            <h4 class="font-semibold">${achievement.title}</h4>
            <p class="text-sm text-gray-600">${achievement.description}</p>
            <p class="text-xs text-gray-500 mt-2">Earned: ${new Date(achievement.earnedAt).toLocaleDateString()}</p>
          </div>
        `).join('');
      }
      
      if (badges.length === 0) {
        badgesContainer.innerHTML = `
          <div class="text-center py-4 text-gray-500">
            <p>No badges earned yet.</p>
          </div>
        `;
      } else {
        badgesContainer.innerHTML = badges.map(badge => `
          <div class="badge">${badge.icon} ${badge.name}</div>
        `).join('');
      }
    }

    // Update settings display
    function updateSettingsDisplay() {
      const prefs = currentProfile.preferences;
      
      // Notification settings
      document.getElementById('emailNotifications').checked = prefs.notifications.email;
      document.getElementById('pushNotifications').checked = prefs.notifications.push;
      document.getElementById('opportunityAlerts').checked = prefs.notifications.newOpportunities;
      document.getElementById('teamUpdates').checked = prefs.notifications.teamUpdates;
      document.getElementById('achievementAlerts').checked = prefs.notifications.achievements;
      
      // Privacy settings
      document.getElementById('profileVisibility').value = prefs.privacy.profileVisibility;
      document.getElementById('showEmail').checked = prefs.privacy.showEmail;
      document.getElementById('showLocation').checked = prefs.privacy.showLocation;
      document.getElementById('showStats').checked = prefs.privacy.showStats;
      
      // AI settings
      document.getElementById('enableAIMatching').checked = prefs.ai.enableMatching;
      document.getElementById('diversityRecommendations').checked = prefs.ai.diversityRecommendations;
      document.getElementById('learningFromInteractions').checked = prefs.ai.learningFromInteractions;
    }

    // Tab management
    function setupTabs() {
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const tabName = e.target.dataset.tab;
          switchTab(tabName);
        });
      });
    }

    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active', 'bg-green-500', 'text-white');
        btn.classList.add('bg-gray-200', 'text-gray-700');
      });
      
      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active', 'bg-green-500', 'text-white');
      document.querySelector(`[data-tab="${tabName}"]`).classList.remove('bg-gray-200', 'text-gray-700');
      
      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.style.display = 'none';
      });
      
      document.getElementById(`${tabName}Tab`).style.display = 'block';
    }

    // Form handlers
    function setupFormHandlers() {
      // Sign out
      document.getElementById('signOutBtn').addEventListener('click', async () => {
        await window.authManager.signOut();
        window.location.href = 'index.html';
      });

      // Edit profile form
      document.getElementById('editProfileForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        await saveProfileEdits();
      });

      // Google sign in
      document.getElementById('googleSignIn').addEventListener('click', async () => {
        try {
          await window.authManager.signInWithGoogle();
          hideLoginModal();
        } catch (error) {
          alert('Sign in failed: ' + error.message);
        }
      });

      // GitHub sign in
      document.getElementById('githubSignIn').addEventListener('click', async () => {
        try {
          await window.authManager.signInWithGitHub();
          hideLoginModal();
        } catch (error) {
          alert('Sign in failed: ' + error.message);
        }
      });
    }

    // Modal functions
    function showLoginModal() {
      document.getElementById('loginModal').style.display = 'flex';
    }

    function hideLoginModal() {
      document.getElementById('loginModal').style.display = 'none';
    }

    function showEditProfileModal() {
      if (!currentProfile) return;
      
      // Populate form
      document.getElementById('editDisplayName').value = currentProfile.personalInfo.displayName;
      document.getElementById('editLocation').value = currentProfile.personalInfo.location || '';
      document.getElementById('editBio').value = currentProfile.personalInfo.bio || '';
      document.getElementById('editExperience').value = currentProfile.volunteerProfile.experience;
      document.getElementById('editTimeCommitment').value = currentProfile.volunteerProfile.timeCommitment;
      
      document.getElementById('editProfileModal').style.display = 'flex';
    }

    function hideEditProfileModal() {
      document.getElementById('editProfileModal').style.display = 'none';
    }

    function showSignUpForm() {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('signUpForm').style.display = 'block';
    }

    function showLoginForm() {
      document.getElementById('signUpForm').style.display = 'none';
      document.getElementById('loginForm').style.display = 'block';
    }

    // Authentication functions
    async function signInWithEmail() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      try {
        await window.authManager.signInWithEmail(email, password);
        hideLoginModal();
      } catch (error) {
        alert('Sign in failed: ' + error.message);
      }
    }

    async function signUpWithEmail() {
      const name = document.getElementById('signUpName').value;
      const email = document.getElementById('signUpEmail').value;
      const password = document.getElementById('signUpPassword').value;
      
      try {
        await window.authManager.signUpWithEmail(email, password, name);
        hideLoginModal();
      } catch (error) {
        alert('Sign up failed: ' + error.message);
      }
    }

    // Profile editing functions
    async function saveProfileEdits() {
      const updates = {
        personalInfo: {
          displayName: document.getElementById('editDisplayName').value,
          location: document.getElementById('editLocation').value,
          bio: document.getElementById('editBio').value
        },
        volunteerProfile: {
          experience: document.getElementById('editExperience').value,
          timeCommitment: document.getElementById('editTimeCommitment').value
        }
      };
      
      await window.authManager.updateProfile(updates);
      hideEditProfileModal();
      showNotification('Profile updated successfully!', 'success');
    }

    async function saveSettings() {
      const preferences = {
        preferences: {
          notifications: {
            email: document.getElementById('emailNotifications').checked,
            push: document.getElementById('pushNotifications').checked,
            newOpportunities: document.getElementById('opportunityAlerts').checked,
            teamUpdates: document.getElementById('teamUpdates').checked,
            achievements: document.getElementById('achievementAlerts').checked
          },
          privacy: {
            profileVisibility: document.getElementById('profileVisibility').value,
            showEmail: document.getElementById('showEmail').checked,
            showLocation: document.getElementById('showLocation').checked,
            showStats: document.getElementById('showStats').checked
          },
          ai: {
            enableMatching: document.getElementById('enableAIMatching').checked,
            diversityRecommendations: document.getElementById('diversityRecommendations').checked,
            learningFromInteractions: document.getElementById('learningFromInteractions').checked
          }
        }
      };
      
      await window.authManager.updateProfile(preferences);
      showNotification('Settings saved successfully!', 'success');
    }

    // Placeholder functions for features to be implemented
    function editSkills() {
      alert('Skills editor coming soon!');
    }

    function editInterests() {
      alert('Interests editor coming soon!');
    }

    function editAvailability() {
      alert('Availability editor coming soon!');
    }

    function editPreferences() {
      alert('Preferences editor coming soon!');
    }

    function showAchievements() {
      switchTab('achievements');
    }

    async function exportData() {
      const data = await window.authManager.exportUserData();
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'impact-profile-data.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function resetProgress() {
      if (confirm('Are you sure you want to reset all your progress? This cannot be undone.')) {
        // Implementation for resetting progress
        alert('Progress reset feature coming soon!');
      }
    }

    function deleteAccount() {
      if (confirm('Are you sure you want to delete your account? This cannot be undone.')) {
        alert('Account deletion feature coming soon!');
      }
    }

    // Utility functions
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white max-w-sm transform transition-all duration-300 translate-x-full`;
      
      switch (type) {
        case 'success':
          notification.classList.add('bg-green-500');
          break;
        case 'error':
          notification.classList.add('bg-red-500');
          break;
        case 'warning':
          notification.classList.add('bg-yellow-500');
          break;
        default:
          notification.classList.add('bg-blue-500');
      }
      
      notification.textContent = message;
      document.body.appendChild(notification);
      
      // Animate in
      setTimeout(() => notification.classList.remove('translate-x-full'), 100);
      
      // Auto remove
      setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }
  </script>
</body>
</html>
