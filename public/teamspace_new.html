<!DOCTYPE html>
<html lang="en">
<head>
  <link href="output.css" rel="stylesheet">
  <link href="animations.css" rel="stylesheet">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TeamSpace â€“ Build Together</title>
</head>
<body class="font-sans bg-gray-50 text-gray-800 leading-relaxed">

  <section class="max-w-7xl mx-auto p-6">
    <header class="mb-8 text-center">
      <h2 class="text-3xl font-bold text-purple-700">ğŸ¤ TeamSpace â€“ Build Together</h2>
      <p class="text-lg text-gray-700">Form project teams, collaborate on ideas, and make collective impact</p>
      <div class="flex justify-center space-x-4 mt-2">
        <a href="index.html" class="text-blue-500 hover:underline">â† Back to Home</a>
        <a href="dashboard_enhanced.html" class="text-purple-500 hover:underline">ğŸ“Š Back to Dashboard</a>
      </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <!-- Left Column: Create Team -->
      <div class="lg:col-span-1 space-y-6">
        
        <!-- Success Message -->
        <div id="successMessage" class="hidden bg-purple-100 border border-purple-400 text-purple-700 px-4 py-3 rounded">
          <strong>Success!</strong> Your team has been created! ğŸ‰ Start inviting members.
        </div>

        <!-- Team Creation Form -->
        <form id="teamForm" class="bg-purple-50 p-6 rounded-lg shadow-md space-y-4">
          <h3 class="text-xl font-semibold text-purple-700 mb-4">ğŸš€ Create New Team</h3>
          
          <div>
            <label for="teamName" class="block font-medium text-gray-700">Team Name:</label>
            <input type="text" id="teamName" class="w-full border border-gray-300 rounded p-2" 
                   placeholder="e.g., Climate Action Heroes" required />
          </div>

          <div>
            <label for="teamPurpose" class="block font-medium text-gray-700">Team Purpose:</label>
            <select id="teamPurpose" class="w-full border border-gray-300 rounded p-2" required>
              <option value="">Select purpose</option>
              <option value="project">ğŸ¯ Work on Specific Project</option>
              <option value="skill-sharing">ğŸ§  Skill Sharing & Learning</option>
              <option value="advocacy">ğŸ“¢ Advocacy & Awareness</option>
              <option value="fundraising">ğŸ’° Fundraising & Resources</option>
              <option value="networking">ğŸ¤ Networking & Support</option>
            </select>
          </div>

          <div>
            <label for="relatedIdea" class="block font-medium text-gray-700">Related Idea (Optional):</label>
            <select id="relatedIdea" class="w-full border border-gray-300 rounded p-2">
              <option value="">Select an idea from Seedboard</option>
              <!-- Ideas will be populated here -->
            </select>
          </div>

          <div>
            <label for="teamDescription" class="block font-medium text-gray-700">Description:</label>
            <textarea id="teamDescription" rows="4" class="w-full border border-gray-300 rounded p-2" 
                      placeholder="Describe your team's goals, activities, and what kind of members you're looking for..." required></textarea>
          </div>

          <div>
            <label for="teamSize" class="block font-medium text-gray-700">Target Team Size:</label>
            <select id="teamSize" class="w-full border border-gray-300 rounded p-2" required>
              <option value="">Select size</option>
              <option value="small">ğŸ‘¥ Small (3-5 members)</option>
              <option value="medium">ğŸ‘¥ğŸ‘¥ Medium (6-10 members)</option>
              <option value="large">ğŸ‘¥ğŸ‘¥ğŸ‘¥ Large (11+ members)</option>
            </select>
          </div>

          <div>
            <label for="skillsNeeded" class="block font-medium text-gray-700">Skills Needed:</label>
            <input type="text" id="skillsNeeded" class="w-full border border-gray-300 rounded p-2" 
                   placeholder="e.g., Project Management, Design, Marketing, Programming" />
          </div>

          <div>
            <label for="meetingFrequency" class="block font-medium text-gray-700">Meeting Frequency:</label>
            <select id="meetingFrequency" class="w-full border border-gray-300 rounded p-2" required>
              <option value="">Select frequency</option>
              <option value="weekly">ğŸ“… Weekly</option>
              <option value="biweekly">ğŸ“… Bi-weekly</option>
              <option value="monthly">ğŸ“… Monthly</option>
              <option value="asneeded">âš¡ As Needed</option>
            </select>
          </div>

          <div>
            <label for="communicationPlatform" class="block font-medium text-gray-700">Communication Platform:</label>
            <select id="communicationPlatform" class="w-full border border-gray-300 rounded p-2" required>
              <option value="">Select platform</option>
              <option value="whatsapp">ğŸ’¬ WhatsApp</option>
              <option value="telegram">ğŸ“± Telegram</option>
              <option value="discord">ğŸ® Discord</option>
              <option value="slack">ğŸ’¼ Slack</option>
              <option value="email">ğŸ“§ Email</option>
            </select>
          </div>

          <button type="submit" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-semibold py-2 px-4 rounded">
            ğŸ¤ Create Team
          </button>
        </form>

        <!-- Team Stats -->
        <div class="bg-white p-4 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold text-purple-700 mb-3">ğŸ“Š Team Stats</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span>Active Teams:</span>
              <span id="activeTeams" class="font-semibold">0</span>
            </div>
            <div class="flex justify-between">
              <span>Total Members:</span>
              <span id="totalMembers" class="font-semibold">0</span>
            </div>
            <div class="flex justify-between">
              <span>Teams Formed Today:</span>
              <span id="teamsToday" class="font-semibold">0</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Columns: Teams & My Teams -->
      <div class="lg:col-span-2 space-y-6">
        
        <!-- Filter Bar -->
        <div class="bg-gray-100 p-4 rounded-lg">
          <h3 class="text-lg font-semibold text-gray-700 mb-3">ğŸ” Find Teams</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <select id="purposeFilter" class="border border-gray-300 rounded p-2">
              <option value="">All Purposes</option>
              <option value="project">ğŸ¯ Project Work</option>
              <option value="skill-sharing">ğŸ§  Skill Sharing</option>
              <option value="advocacy">ğŸ“¢ Advocacy</option>
              <option value="fundraising">ğŸ’° Fundraising</option>
              <option value="networking">ğŸ¤ Networking</option>
            </select>
            <select id="sizeFilter" class="border border-gray-300 rounded p-2">
              <option value="">All Sizes</option>
              <option value="small">ğŸ‘¥ Small Teams</option>
              <option value="medium">ğŸ‘¥ğŸ‘¥ Medium Teams</option>
              <option value="large">ğŸ‘¥ğŸ‘¥ğŸ‘¥ Large Teams</option>
            </select>
            <input type="text" id="skillFilter" placeholder="Search by skills..." 
                   class="border border-gray-300 rounded p-2">
          </div>
        </div>

        <!-- Available Teams -->
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-xl font-semibold text-purple-700 mb-4">ğŸŒŸ Available Teams</h3>
          <div id="teamsList" class="space-y-4">
            <!-- Teams will be displayed here -->
          </div>
        </div>

        <!-- My Teams -->
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-xl font-semibold text-gray-700 mb-4">ğŸ‘¤ My Teams</h3>
          <div id="myTeams" class="space-y-3">
            <!-- User's teams will be displayed here -->
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    // Initialize DOM elements
    const teamForm = document.getElementById('teamForm');
    const teamsList = document.getElementById('teamsList');
    const myTeams = document.getElementById('myTeams');
    const successMessage = document.getElementById('successMessage');
    const relatedIdeaSelect = document.getElementById('relatedIdea');
    const purposeFilter = document.getElementById('purposeFilter');
    const sizeFilter = document.getElementById('sizeFilter');
    const skillFilter = document.getElementById('skillFilter');

    // Initialize data arrays
    let teams = JSON.parse(localStorage.getItem('teams')) || [];
    let userMemberships = JSON.parse(localStorage.getItem('userMemberships')) || [];
    let impactIdeas = JSON.parse(localStorage.getItem('impactIdeas')) || [];

    // Configuration objects
    const purposeConfig = {
      'project': { icon: 'ğŸ¯', label: 'Project Work', color: 'blue' },
      'skill-sharing': { icon: 'ğŸ§ ', label: 'Skill Sharing', color: 'yellow' },
      'advocacy': { icon: 'ğŸ“¢', label: 'Advocacy', color: 'red' },
      'fundraising': { icon: 'ğŸ’°', label: 'Fundraising', color: 'green' },
      'networking': { icon: 'ğŸ¤', label: 'Networking', color: 'purple' }
    };

    const sizeConfig = {
      'small': { icon: 'ğŸ‘¥', label: 'Small (3-5)', max: 5 },
      'medium': { icon: 'ğŸ‘¥ğŸ‘¥', label: 'Medium (6-10)', max: 10 },
      'large': { icon: 'ğŸ‘¥ğŸ‘¥ğŸ‘¥', label: 'Large (11+)', max: 20 }
    };

    // Initialize display
    populateIdeasDropdown();
    displayTeams();
    displayMyTeams();
    updateStats();

    // Populate related ideas dropdown
    function populateIdeasDropdown() {
      relatedIdeaSelect.innerHTML = '<option value="">Select an idea from Seedboard</option>';
      
      impactIdeas.forEach(idea => {
        const option = document.createElement('option');
        option.value = idea.id || idea.title;
        option.textContent = `${idea.title} (${idea.location || 'No location'})`;
        relatedIdeaSelect.appendChild(option);
      });
    }

    // Handle team form submission
    teamForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const newTeam = {
        id: Date.now(),
        name: document.getElementById('teamName').value,
        purpose: document.getElementById('teamPurpose').value,
        relatedIdea: document.getElementById('relatedIdea').value,
        description: document.getElementById('teamDescription').value,
        targetSize: document.getElementById('teamSize').value,
        skillsNeeded: document.getElementById('skillsNeeded').value,
        meetingFrequency: document.getElementById('meetingFrequency').value,
        communicationPlatform: document.getElementById('communicationPlatform').value,
        creator: 'Current User', // In a real app, this would be the logged-in user
        createdDate: new Date().toISOString(),
        members: ['Current User'], // Creator is automatically a member
        status: 'recruiting'
      };

      teams.push(newTeam);
      localStorage.setItem('teams', JSON.stringify(teams));
      
      // Add user membership
      const membership = {
        teamId: newTeam.id,
        teamName: newTeam.name,
        role: 'creator',
        joinedDate: new Date().toISOString()
      };
      userMemberships.push(membership);
      localStorage.setItem('userMemberships', JSON.stringify(userMemberships));
      
      // Show success message
      successMessage.classList.remove('hidden');
      setTimeout(() => {
        successMessage.classList.add('hidden');
      }, 3000);
      
      teamForm.reset();
      displayTeams();
      displayMyTeams();
      updateStats();
    });

    // Handle filter changes
    [purposeFilter, sizeFilter, skillFilter].forEach(filter => {
      filter.addEventListener('change', displayTeams);
      filter.addEventListener('input', displayTeams);
    });

    // Display available teams
    function displayTeams() {
      teamsList.innerHTML = '';
      
      if (teams.length === 0) {
        teamsList.innerHTML = `
          <div class="text-center py-8 text-gray-500">
            <div class="text-4xl mb-3">ğŸ¤</div>
            <p>No teams created yet.</p>
            <p class="text-sm mt-2">Be the first to create a team and start collaborating!</p>
          </div>
        `;
        return;
      }

      // Filter teams
      let filteredTeams = teams.filter(team => {
        const matchesPurpose = !purposeFilter.value || team.purpose === purposeFilter.value;
        const matchesSize = !sizeFilter.value || team.targetSize === sizeFilter.value;
        const matchesSkill = !skillFilter.value || 
                            team.skillsNeeded.toLowerCase().includes(skillFilter.value.toLowerCase()) ||
                            team.name.toLowerCase().includes(skillFilter.value.toLowerCase());
        return matchesPurpose && matchesSize && matchesSkill && team.status === 'recruiting';
      });

      // Sort by creation date (newest first)
      filteredTeams.sort((a, b) => new Date(b.createdDate) - new Date(a.createdDate));

      if (filteredTeams.length === 0) {
        teamsList.innerHTML = '<p class="text-center text-gray-500 py-4">No teams match your filters.</p>';
        return;
      }

      filteredTeams.forEach(team => {
        const purposeInfo = purposeConfig[team.purpose];
        const sizeInfo = sizeConfig[team.targetSize];
        const isMember = userMemberships.some(membership => membership.teamId === team.id);
        const spotsLeft = sizeInfo.max - team.members.length;

        const teamCard = document.createElement('div');
        teamCard.className = `border-l-4 border-${purposeInfo.color}-400 bg-${purposeInfo.color}-50 p-4 rounded-lg shadow-sm`;
        
        teamCard.innerHTML = `
          <div class="flex justify-between items-start mb-3">
            <div class="flex items-center gap-2">
              <span class="text-2xl">${purposeInfo.icon}</span>
              <div>
                <h4 class="font-bold text-gray-800">${team.name}</h4>
                <div class="flex gap-3 text-sm text-gray-600 mt-1">
                  <span>${sizeInfo.icon} ${team.members.length}/${sizeInfo.max} members</span>
                  <span>ğŸ“… ${team.meetingFrequency}</span>
                  <span>ğŸ’¬ ${team.communicationPlatform}</span>
                </div>
              </div>
            </div>
            <div class="text-right">
              <div class="text-xs font-semibold text-${purposeInfo.color}-600">${purposeInfo.label}</div>
              <div class="text-xs text-gray-500">${spotsLeft} spots left</div>
            </div>
          </div>
          
          <p class="text-sm text-gray-700 mb-3">${team.description}</p>
          
          ${team.skillsNeeded ? `
            <div class="bg-white p-2 rounded mb-3">
              <span class="text-xs font-semibold text-gray-600">Skills Needed:</span>
              <span class="text-xs text-gray-700">${team.skillsNeeded}</span>
            </div>
          ` : ''}
          
          ${team.relatedIdea ? `
            <div class="bg-white p-2 rounded mb-3">
              <span class="text-xs font-semibold text-gray-600">Related Idea:</span>
              <span class="text-xs text-blue-600">${getIdeaTitle(team.relatedIdea)}</span>
            </div>
          ` : ''}
          
          <div class="flex gap-2 items-center">
            ${isMember ? `
              <button class="bg-green-600 text-white py-1 px-3 rounded text-sm cursor-not-allowed" disabled>
                âœ… Already Joined
              </button>
            ` : spotsLeft > 0 ? `
              <button class="bg-purple-500 hover:bg-purple-600 text-white py-1 px-3 rounded text-sm join-btn" 
                      data-team-id="${team.id}">
                ğŸ¤ Join Team
              </button>
            ` : `
              <button class="bg-gray-400 text-white py-1 px-3 rounded text-sm cursor-not-allowed" disabled>
                ğŸš« Team Full
              </button>
            `}
            <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 py-1 px-3 rounded text-sm info-btn"
                    data-team-id="${team.id}">
              â„¹ï¸ More Info
            </button>
            <span class="text-xs text-gray-500 ml-auto">Created by ${team.creator}</span>
          </div>
        `;

        // Add join functionality
        const joinBtn = teamCard.querySelector('.join-btn');
        if (joinBtn) {
          joinBtn.addEventListener('click', () => joinTeam(team.id));
        }

        // Add info functionality
        const infoBtn = teamCard.querySelector('.info-btn');
        infoBtn.addEventListener('click', () => showTeamInfo(team));

        teamsList.appendChild(teamCard);
      });
    }

    // Display user's teams
    function displayMyTeams() {
      myTeams.innerHTML = '';
      
      if (userMemberships.length === 0) {
        myTeams.innerHTML = '<p class="text-gray-500 text-center">You haven\'t joined any teams yet.</p>';
        return;
      }

      userMemberships.forEach(membership => {
        const team = teams.find(t => t.id === membership.teamId);
        if (!team) return;

        const membershipCard = document.createElement('div');
        membershipCard.className = 'bg-purple-50 p-3 rounded border-l-4 border-purple-400';
        
        const roleIcons = {
          'creator': 'ğŸ‘‘',
          'admin': 'â­',
          'member': 'ğŸ‘¤'
        };
        
        membershipCard.innerHTML = `
          <div class="flex justify-between items-start">
            <div>
              <h5 class="font-semibold text-gray-800">${team.name}</h5>
              <p class="text-sm text-gray-600">${purposeConfig[team.purpose]?.label || team.purpose}</p>
              <p class="text-xs text-gray-500">Joined: ${new Date(membership.joinedDate).toLocaleDateString()}</p>
            </div>
            <div class="text-right">
              <span class="text-lg">${roleIcons[membership.role]}</span>
              <div class="text-xs text-purple-600">${membership.role}</div>
            </div>
          </div>
        `;
        myTeams.appendChild(membershipCard);
      });
    }

    // Join team function
    function joinTeam(teamId) {
      const team = teams.find(t => t.id === teamId);
      if (!team) return;

      const sizeInfo = sizeConfig[team.targetSize];
      if (team.members.length >= sizeInfo.max) {
        alert('This team is already full!');
        return;
      }

      // Add user to team
      team.members.push('Current User');
      
      // Update teams in localStorage
      localStorage.setItem('teams', JSON.stringify(teams));
      
      // Add membership record
      const membership = {
        teamId: teamId,
        teamName: team.name,
        role: 'member',
        joinedDate: new Date().toISOString()
      };
      userMemberships.push(membership);
      localStorage.setItem('userMemberships', JSON.stringify(userMemberships));

      alert(`Welcome to ${team.name}! You've successfully joined the team.`);
      displayTeams();
      displayMyTeams();
      updateStats();
    }

    // Show team info function
    function showTeamInfo(team) {
      const purposeInfo = purposeConfig[team.purpose];
      const sizeInfo = sizeConfig[team.targetSize];
      
      const info = `
Team: ${team.name}
Purpose: ${purposeInfo.label}
Members: ${team.members.length}/${sizeInfo.max}
Meeting Frequency: ${team.meetingFrequency}
Communication: ${team.communicationPlatform}
Skills Needed: ${team.skillsNeeded || 'None specified'}
Created: ${new Date(team.createdDate).toLocaleDateString()}

Description:
${team.description}
      `;
      
      alert(info);
    }

    // Get idea title by ID
    function getIdeaTitle(ideaId) {
      const idea = impactIdeas.find(i => i.id === ideaId || i.title === ideaId);
      return idea ? idea.title : ideaId;
    }

    // Update statistics
    function updateStats() {
      const activeTeams = teams.filter(team => team.status === 'recruiting').length;
      const totalMembers = teams.reduce((total, team) => total + team.members.length, 0);
      const today = new Date().toDateString();
      const teamsToday = teams.filter(team => 
        new Date(team.createdDate).toDateString() === today
      ).length;

      document.getElementById('activeTeams').textContent = activeTeams;
      document.getElementById('totalMembers').textContent = totalMembers;
      document.getElementById('teamsToday').textContent = teamsToday;
    }

    // Enhanced visual features for TeamSpace
    document.addEventListener('DOMContentLoaded', function() {
      // Add UI components
      if (typeof showLoading !== 'function') {
        window.showLoading = function(message) {
          const loading = document.createElement('div');
          loading.id = 'loadingOverlay';
          loading.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
          loading.innerHTML = `
            <div class="bg-white p-6 rounded-lg shadow-xl text-center">
              <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500 mx-auto mb-4"></div>
              <p class="text-gray-700">${message}</p>
            </div>
          `;
          document.body.appendChild(loading);
        };

        window.hideLoading = function() {
          const loading = document.getElementById('loadingOverlay');
          if (loading) loading.remove();
        };

        window.showToast = function(message, type = 'success') {
          const toast = document.createElement('div');
          toast.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300 ${
            type === 'success' ? 'bg-purple-500 text-white' : 
            type === 'warning' ? 'bg-orange-500 text-white' : 
            'bg-blue-500 text-white'
          }`;
          toast.textContent = message;
          document.body.appendChild(toast);
          
          setTimeout(() => toast.classList.remove('translate-x-full'), 100);
          setTimeout(() => {
            toast.classList.add('translate-x-full');
            setTimeout(() => toast.remove(), 300);
          }, 3000);
        };
      }

      // Enhanced form animations
      const formInputs = document.querySelectorAll('#teamForm input, #teamForm textarea, #teamForm select');
      formInputs.forEach(input => {
        input.addEventListener('focus', function() {
          this.parentElement.classList.add('ring-2', 'ring-purple-200');
          this.classList.add('transform', 'scale-105');
        });
        input.addEventListener('blur', function() {
          this.parentElement.classList.remove('ring-2', 'ring-purple-200');
          this.classList.remove('transform', 'scale-105');
        });
      });

      // Enhanced form submission
      const teamForm = document.getElementById('teamForm');
      const originalSubmit = teamForm.onsubmit;
      teamForm.onsubmit = function(e) {
        e.preventDefault();
        showLoading('Building your dream team... ğŸ¤');
        
        setTimeout(() => {
          hideLoading();
          if (originalSubmit) originalSubmit.call(this, e);
          showToast('ğŸ¤ Team created! Start recruiting members to bring your vision to life.', 'success');
        }, 1200);
      };

      // Enhanced team cards
      function enhanceTeamCards() {
        const teamCards = document.querySelectorAll('#teamsList .bg-white');
        teamCards.forEach((card, index) => {
          card.classList.add('card-hover', 'transition-all', 'duration-300');
          
          // Add status-based visual indicators
          const statusEl = card.querySelector('.px-2.py-1.text-xs.rounded-full');
          if (statusEl) {
            const status = statusEl.textContent.toLowerCase();
            if (status.includes('recruiting')) {
              card.classList.add('border-l-4', 'border-purple-500');
              statusEl.classList.add('animate-pulse');
            } else if (status.includes('active')) {
              card.classList.add('border-l-4', 'border-green-500');
            } else {
              card.classList.add('border-l-4', 'border-gray-400');
            }
          }

          // Stagger entrance animations
          card.style.opacity = '0';
          card.style.transform = 'translateY(20px)';
          setTimeout(() => {
            card.style.transition = 'all 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
          }, index * 150);
        });
      }

      // Enhanced join functionality
      window.originalJoinTeam = window.joinTeam;
      window.joinTeam = function(teamId) {
        showLoading('Joining the team...');
        setTimeout(() => {
          hideLoading();
          originalJoinTeam(teamId);
          showToast('ğŸ‰ Welcome to the team! Check your email for next steps.', 'success');
        }, 800);
      };

      // Auto-refresh with animations
      const originalDisplayTeams = window.displayTeams;
      window.displayTeams = function() {
        originalDisplayTeams();
        setTimeout(enhanceTeamCards, 100);
      };

      // Initial enhancements
      setTimeout(enhanceTeamCards, 500);
    });
  </script>
  <script src="ui-components.js"></script>
</body>
</html>
