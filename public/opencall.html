<!DOCTYPE html>
<html lang="en">
<head>
  <link href="output.css" rel="stylesheet">
  <link href="animations.css" rel="stylesheet">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OpenCall – Urgent Community Needs</title>
</head>
<body class="font-sans bg-gray-50 text-gray-800 leading-relaxed">

  <section class="max-w-6xl mx-auto p-6">
    <header class="mb-6 text-center">
      <h2 class="text-2xl font-bold text-red-700">📣 OpenCall – Urgent Community Needs</h2>
      <p class="text-lg text-gray-700">Respond to calls for volunteers and ideas. Every moment counts.</p>
      <div class="flex justify-center space-x-4 mt-2">
        <a href="index.html" class="text-blue-500 hover:underline">← Back to Home</a>
        <a href="dashboard_enhanced.html" class="text-purple-500 hover:underline">📊 Back to Dashboard</a>
      </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <!-- Left Column: Create Call -->
      <div class="lg:col-span-1 space-y-6">
        
        <!-- Success Message -->
        <div id="successMessage" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
          <strong>Success!</strong> Your call has been posted! 🚨 The community will be notified.
        </div>

        <!-- Call Form -->
        <form id="callForm" class="bg-red-50 p-6 rounded-lg shadow-md space-y-4">
          <h3 class="text-xl font-semibold text-red-700 mb-4">� Post Urgent Call</h3>
          
          <div>
            <label for="callTitle" class="block font-medium text-gray-700">Call Title:</label>
            <input type="text" id="callTitle" class="w-full border border-gray-300 rounded p-2" 
                   placeholder="e.g., Emergency Flood Relief Volunteers Needed" required />
          </div>

          <div>
            <label for="urgencyLevel" class="block font-medium text-gray-700">Urgency Level:</label>
            <select id="urgencyLevel" class="w-full border border-gray-300 rounded p-2" required>
              <option value="">Select urgency</option>
              <option value="critical">🔴 Critical (Immediate action required)</option>
              <option value="high">🟠 High (Within 24 hours)</option>
              <option value="medium">🟡 Medium (Within 1 week)</option>
              <option value="low">🟢 Low (Flexible timing)</option>
            </select>
          </div>

          <div>
            <label for="callType" class="block font-medium text-gray-700">Call Type:</label>
            <select id="callType" class="w-full border border-gray-300 rounded p-2" required>
              <option value="">Select type</option>
              <option value="volunteers">👥 Need Volunteers</option>
              <option value="resources">📦 Need Resources/Donations</option>
              <option value="expertise">🧠 Need Expertise/Skills</option>
              <option value="coordination">🤝 Need Coordination Help</option>
              <option value="awareness">📢 Need Awareness/Sharing</option>
            </select>
          </div>

          <div>
            <label for="callDescription" class="block font-medium text-gray-700">Description:</label>
        <textarea id="description" name="description" rows="3" class="w-full border border-gray-300 rounded p-2" required></textarea>
      </div>

      <div>
        <label for="cause" class="block font-medium text-gray-700">Cause/Theme</label>
        <input type="text" id="cause" name="cause" class="w-full border border-gray-300 rounded p-2" required />
      </div>

      <div>
        <label for="deadline" class="block font-medium text-gray-700">Deadline</label>
        <input type="date" id="deadline" name="deadline" class="w-full border border-gray-300 rounded p-2" />
      </div>

      <button type="submit" class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded">
        📤 Submit OpenCall
      </button>
      <p class="text-sm text-gray-500 italic mt-2">Every call is a seed of change.</p>
    </form>

    <!-- Opportunity Cards -->
    <section id="callList" class="mt-10 space-y-6">
      <h3 class="text-xl font-semibold text-indigo-700 mb-4">🌍 Available Opportunities</h3>
      <!-- Calls will be injected here -->
    </section>
  </section>

  <!-- JavaScript for handling calls -->
  <script>
    const callForm = document.getElementById('callForm');
    const callList = document.getElementById('callList');

    let calls = [];

    callForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const title = document.getElementById('title').value;
      const description = document.getElementById('description').value;
      const cause = document.getElementById('cause').value;
      const deadline = document.getElementById('deadline').value;

      const newCall = { title, description, cause, deadline };
      calls.unshift(newCall); // newest first
      callForm.reset();
      renderCalls();
    });

    function renderCalls() {
      callList.innerHTML = '';

      calls.forEach(call => {
        const card = document.createElement('div');
        card.className = 'bg-white rounded-lg shadow-md p-4';

        card.innerHTML = `
          <h4 class="font-bold text-indigo-700 mb-1">📌 ${call.title}</h4>
          <p class="text-sm text-gray-700 mb-1"><strong>Cause:</strong> ${call.cause}</p>
          <p class="text-sm text-gray-700 mb-2">${call.description}</p>
          ${call.deadline ? `<p class="text-xs text-gray-500 mb-2">Deadline: ${call.deadline}</p>` : ''}
          <div class="flex gap-2">
            <button class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-1 px-3 rounded">
              🙋 I'm Interested
            </button>
            <button onclick="reflectNow('${call.title}', '${call.cause}')" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-1 px-3 rounded">
              ✍️ Reflect Now
            </button>
          </div>
        `;
        callList.appendChild(card);
      });
    }

    function reflectNow(title, cause) {
      const params = new URLSearchParams({ title, cause });
      window.location.href = `impactlog.html?${params.toString()}`;
    }
  </script>

  <script src="ui-components.js"></script>
  <script>
    // Enhanced OpenCall functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Add animations to form elements
      const formInputs = document.querySelectorAll('#callForm input, #callForm select, #callForm textarea');
      formInputs.forEach(input => {
        input.addEventListener('focus', function() {
          this.parentElement.classList.add('ring-2', 'ring-red-200');
        });
        input.addEventListener('blur', function() {
          this.parentElement.classList.remove('ring-2', 'ring-red-200');
        });
      });

      // Override the original form submission to add toast notification
      const originalFormSubmit = callForm.onsubmit;
      callForm.onsubmit = function(e) {
        e.preventDefault();
        showLoading('Posting urgent call...');
        
        setTimeout(() => {
          hideLoading();
          originalFormSubmit.call(this, e);
          showToast('Urgent call posted successfully! 🚨 Community members will be notified.', 'success');
        }, 1000);
      };

      // Add urgent animation to critical calls
      function addUrgentAnimations() {
        const criticalCalls = document.querySelectorAll('[data-urgency="critical"]');
        criticalCalls.forEach(call => {
          call.classList.add('pulse-urgent');
        });
      }

      // Enhance response functionality
      window.originalRespondToCall = window.respondToCall;
      window.respondToCall = function(callId) {
        showLoading('Processing your response...');
        setTimeout(() => {
          hideLoading();
          originalRespondToCall(callId);
          showToast('Thank you for responding! Your help can make a real difference. 🙏', 'success');
        }, 800);
      };

      // Add visual feedback to share functionality
      window.originalShareCall = window.shareCall;
      window.shareCall = function(call) {
        originalShareCall(call);
        showToast('Call details copied to clipboard! Share to amplify the impact. 📤', 'info');
      };

      // Auto-refresh call list every 30 seconds
      setInterval(() => {
        displayCalls();
        updateStats();
        addUrgentAnimations();
      }, 30000);

      // Initial animations
      setTimeout(addUrgentAnimations, 500);
    });
  </script>
</body>
</html>
